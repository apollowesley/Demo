#!/usr/bin/env python
# -*- coding: utf-8 -*-
from tornado import gen, ioloop
from uline.model.uline.info import MchInletInfo, AddressInfo
from uline.public.db import initdb, uline_session_scope
from uline.model.uline.base import uline_session
from uline.utils.alipay.get_areaname_by_upper_code import get_areanames_by_city
from sqlalchemy import text


@gen.coroutine
def update_error_address():
    mch_inlet_infos = uline_session.query(MchInletInfo).filter(MchInletInfo.mch_id.in_(
        ['100000734062', '100000734062', '100000642615', '100000642615', '100001307186', '100000985183', '100000985183', '100000196393', '100000196393', '100000642527', '100000642527', '100001157553', '100000034536', '100000034536', '100000035591', '100000035591', '100000035612', '100000035612', '100000044938', '100000044938', '100001355352', '100001355352', '100000159822', '100000159822', '100000045616', '100000045616', '100000022791', '100000022791', '100000038521', '100000038521', '100000580194', '100000580194', '100000648167', '100000648167', '100000038979', '100000038979', '100000578172', '100000578172', '100001389552', '100000521983', '100000521983', '100000201552', '100000201552', '100000039057', '100000039057', '100000019416', '100000019416', '100000714986', '100000714986', '100000166957', '100000166957', '100000036976', '100000040365', '100000040365', '100000159962', '100000159962', '100000339320', '100000339320', '100000191418', '100000191418', '100000203463', '100000203463', '100000204619', '100000204619', '100000339582', '100000339582', '100000023157', '100000023157', '100000340241', '100000340241', '100000975867', '100000975867', '100000158950', '100000158950', '100000786816', '100000786816', '100000035773', '100000035773', '100000036081', '100000036081', '100000341446', '100000341446', '100000006032', '100000006032', '100000033211', '100000033211', '100000684396', '100000684396', '100000880065', '100000880065', '100000822814', '100000822814', '100001390115', '100000764262', '100000764262', '100000785130', '100000785130', '100001409110', '100000984327', '100000984327', '100000984789', '100000984789', '100001238016', '100000578270', '100000578270', '100000984836', '100000984836', '100000985087', '100000985087', '100000023297', '100000023297', '100000521858', '100000521858', '100000725672', '100000725672', '100001260191', '100001260191', '100000967928', '100000967928', '100000757768', '100000954777', '100000954777', '100001217899', '100001217899', '100000669055', '100000777611', '100000777611', '100000777472', '100000777472', '100000797082', '100000797082', '100000734578', '100000734578', '100001405692', '100001405692', '100000799820', '100000799820', '100000009087', '100000009087', '100000640520', '100000640520', '100000761492', '100000761492', '100000671986', '100000671986', '100000983855', '100000983855', '100000646298', '100000646298', '100000883522', '100000883522', '100000955894', '100000955894', '100000829464', '100000829464', '100000343770', '100000343770', '100000276989', '100000276989', '100000503633', '100000503633', '100001006773', '100001006773', '100000587294', '100000276773', '100000276773', '100001100236', '100001100236', '100000475660', '100000475660', '100000990141', '100000990141', '100000710890', '100000710890', '100001002617', '100001002617', '100000641355', '100000641355', '100000612638', '100000612638', '100000611947', '100000611947', '100000470048', '100000470048', '100000583399', '100000583399', '100000895642', '100000895642', '100000884474', '100000884474', '100000980628', '100000980628', '100000726357', '100000913657', '100000726476', '100000729387', '100000775210', '100000965098', '100000965098', '100000793578', '100000793578', '100001087628', '100001087628', '100001178958', '100001178958', '100001239285', '100001239285', '100001177257', '100001177257', '100001178270', '100001178270', '100001175991', '100001175991', '100001179596', '100001179596', '100001155789', '100001155789', '100001155150', '100001155150', '100001156931', '100001156931', '100001157256', '100001157256', '100001160595', '100001160595', '100001156643', '100001156643', '100001156284', '100001156284', '100001071618', '100001071618', '100001070589', '100001070589', '100001160184', '100001160184', '100001072462', '100001072462', '100001227821', '100001227821', '100001184263', '100001184263', '100001184441', '100001184441', '100001068098', '100001068098', '100000794447', '100000794447', '100000794320', '100000794320', '100000794247', '100000794247', '100000794513', '100000794513', '100000882351', '100000882351', '100000882573', '100000882573', '100000882685', '100000882685', '100000795626', '100000795790', '100000167491', '100000167491', '100001324687', '100001324687', '100000633156', '100000633156', '100000633556', '100000633556', '100000592041', '100000592041', '100000644272', '100000644272', '100000784941', '100000784941', '100000017318', '100000017318', '100000515553', '100000515553', '100000511976', '100000511976', '100000634356', '100000634356', '100000594517', '100000594517', '100000594115', '100000594115', '100000518254', '100000518254', '100000518867', '100000518867', '100000614979', '100000614979', '100000629367', '100000629367', '100000029618', '100000029618', '100000524160', '100000524160', '100000523266', '100000524953', '100000524953', '100000156660', '100000156660', '100000617492', '100000617492', '100000596974', '100000596974', '100000825237', '100000532096', '100000532096', '100001069329', '100001069329', '100000531683', '100000531683', '100000531848', '100000531848', '100001049565', '100001049565', '100000991941', '100000991941', '100000843590', '100000843590', '100001127511', '100001127511', '100000541130', '100000541130', '100000531929', '100000531929', '100000963496', '100000963496', '100000640740', '100000640740', '100000532453', '100000532453', '100000532395', '100000532395', '100000859553', '100000859553', '100001218562', '100001218562', '100000532821', '100000532821', '100001218417', '100001218417', '100001220957', '100000640629', '100000640629', '100000956998', '100000956998', '100000619923', '100000619923', '100001385978', '100001385978', '100001324921', '100001324921', '100000642459', '100000642459', '100001304282', '100001304282', '100000600657', '100000600657', '100000637488', '100000637488', '100001342218', '100001342218', '100000638016', '100000638016', '100001048887', '100001048887', '100000546223', '100000546223', '100001174989', '100001174989', '100000028568', '100000028568', '100000637637', '100000637637', '100000622946', '100000622946', '100000554419', '100000554419', '100000624661', '100000624661', '100001409726', '100001409726', '100001359788', '100001359788', '100001359690', '100001359690', '100000622868', '100000622868', '100001054056', '100001054056', '100001343729', '100001343729', '100001359393', '100001359393', '100001359592', '100001359592', '100001359439', '100001359439', '100000640448', '100000640448', '100000625080', '100000625080', '100000567883', '100000567883', '100000569851', '100000569851', '100000625534', '100000625534', '100000624083', '100000624083', '100001146897', '100000518713', '100000518713', '100000491388', '100000578952', '100000578952', '100000040411', '100000040411', '100000579722', '100000579722', '100000611065', '100000579622', '100000579622', '100000579868', '100000579868', '100000612899', '100000612899', '100000628597', '100000628597', '100000631346', '100000631346', '100000629219', '100000629219', '100000768085', '100000768085', '100000644373', '100000644373', '100000743439', '100000743439', '100001087352', '100001087352', '100000795317', '100000795497', '100000795542', '100000439157', '100000439157', '100000167586', '100000167586', '100000748327', '100000645253', '100000645253', '100000786118', '100000786118',
            '100000644911', '100000644911', '100000649777', '100000649777', '100000651423', '100000651423', '100001205270', '100001205270', '100000655635', '100000655635', '100000655450', '100000655450', '100001087465', '100001087465', '100001087815', '100001087815', '100000662728', '100000662728', '100000774458', '100000774458', '100000803379', '100000803379', '100000797287', '100000797287', '100000774894', '100000774894', '100000660749', '100000660749', '100000776030', '100000776030', '100000775712', '100000775712', '100000775040', '100000775040', '100000751032', '100000751032', '100000554633', '100000554633', '100000776921', '100000776921', '100000668411', '100000668411', '100000776864', '100000776864', '100000802977', '100000802977', '100000803181', '100000803181', '100000803017', '100000803017', '100000668827', '100000668827', '100000672230', '100000672230', '100000275667', '100000275667', '100000673060', '100000673060', '100000452778', '100000452778', '100000673823', '100000673823', '100000677016', '100000677016', '100000803295', '100000803295', '100000683412', '100000683412', '100000799765', '100000799765', '100000775417', '100000775417', '100000681059', '100001032963', '100001032963', '100000689156', '100000689156', '100000689385', '100000689385', '100000689963', '100000689963', '100000695995', '100000695995', '100000696366', '100000696366', '100000704483', '100000704483', '100001363141', '100001363141', '100000701725', '100000701725', '100000708063', '100000708063', '100000710484', '100000761083', '100000761083', '100000710674', '100000710674', '100000716863', '100000716863', '100000722439', '100000722439', '100000725715', '100000725715', '100000730696', '100000730696', '100000732846', '100000732846', '100000726532', '100001084556', '100001084556', '100001127835', '100001127835', '100001084223', '100001084223', '100000821843', '100000806138', '100000806138', '100000825058', '100000825125', '100000796630', '100000796630', '100000954210', '100000954210', '100000992112', '100000323245', '100001043482', '100001043482', '100001043715', '100001043715', '100000834056', '100000834056', '100000748193', '100000748193', '100000795261', '100000795261', '100000842394', '100000842394', '100000842844', '100000842844', '100000323318', '100000844710', '100000844710', '100001397860', '100001397860', '100000822779', '100000636231', '100000636231', '100000846572', '100000846572', '100001051542', '100001051542', '100001381867', '100001381867', '100001336711', '100001336711', '100001053087', '100001053087', '100000859740', '100000859740', '100000862540', '100000862540', '100000862462', '100000862462', '100000875116', '100000875116', '100001056870', '100001337529', '100001337529', '100000882412', '100000882412', '100001094299', '100001094299', '100001384217', '100001384217', '100000493772', '100001408198', '100001408198', '100000895193', '100000895193', '100000331339', '100000331339', '100001098020', '100001098020', '100001102890', '100001102890', '100000901833', '100000901833', '100001125798', '100001125798', '100000901689', '100000901689', '100001137566', '100000903844', '100000903844', '100001062065', '100001062065', '100000907423', '100000907423', '100000824966', '100000914153', '100000914153', '100001341031', '100001341031', '100000927389', '100000927389', '100000930632', '100000930632', '100000939093', '100000939093', '100000941236', '100000941236', '100000960066', '100000960066', '100000941695', '100000941695', '100001154242', '100001154242', '100001154542', '100001154542', '100000161253', '100000161253', '100000486586', '100000486586', '100000951466', '100000951466', '100001336575', '100001336575', '100001070196', '100001070196', '100001071438', '100001071438', '100001070763', '100001070763', '100001071126', '100001071126', '100001342136', '100001342136', '100001071824', '100001071824', '100000960160', '100000960160', '100000960318', '100000960318', '100001072973', '100001072973', '100000964950', '100000964950', '100000701892', '100000701892', '100001072065', '100001072065', '100000974285', '100000974285', '100000578037', '100000578037', '100000578654', '100000578654', '100000520832', '100000520832', '100000976412', '100000976412', '100000192661', '100000192661', '100000501190', '100000501190', '100000976866', '100000976866', '100000978994', '100000978994', '100000978416', '100000978416', '100000979683', '100000979683', '100000982712', '100000982712', '100000983588', '100000983588', '100000983955', '100000983955', '100000984090', '100000984090', '100000984510', '100000984510', '100000985218', '100000985218', '100000991576', '100001000543', '100001000543', '100000258220', '100000258220', '100001013838', '100001013838', '100001043559', '100001043559', '100001017577', '100001017577', '100000444318', '100001143625', '100001051981', '100001051981', '100001127782', '100001127782', '100001342576', '100001342576', '100001155563', '100001155563', '100001156858', '100001156858', '100001349097', '100001349097', '100000257343', '100000257343', '100000882218', '100000882218', '100001175532', '100001174539', '100001174539', '100001176798', '100001176798', '100001179254', '100001179254', '100001180062', '100001180062', '100001180631', '100001180631', '100001097820', '100001097820', '100001199868', '100001199868', '100001198218', '100001198218', '100001192935', '100000740047', '100000740047', '100001206754', '100001356693', '100001215694', '100001215694', '100001215949', '100001215949', '100000919921', '100000919921', '100001063359', '100001063359', '100000922082', '100000922082', '100000003277', '100000003277', '100001239041', '100001239041', '100001341499', '100001341499', '100000794685', '100000794685', '100001240197', '100001240197', '100001242387', '100001242387', '100001290437', '100001290437', '100001249216', '100001249216', '100001258761', '100001258761', '100000944893', '100000944893', '100001336896', '100001336896', '100001243535', '100001243535', '100001277010', '100001277010', '100001283392', '100001283392', '100001285873', '100001285873', '100001072273', '100001072273', '100001290594', '100000748449', '100000748449', '100000194610', '100000194610', '100000975615', '100000975615', '100000978510', '100000978510', '100000522843', '100000522843', '100001299676', '100001299676', '100001312040', '100001312040', '100001310857', '100001310857', '100001405731', '100001405731', '100001324121', '100001324121', '100001322861', '100001322861', '100001150895', '100001150895', '100001351032', '100001351032', '100001324815', '100001324815', '100001411647', '100000197250', '100000197250', '100000199147', '100000199147', '100001554426', '100001554426', '100000776791', '100000776791', '100001559375', '100001559375', '100000776573', '100000776573', '100000776615', '100000776615', '100000824866', '100000776320', '100000776320', '100000775684', '100000775684', '100000775377', '100000775377', '100000775172', '100000775172', '100001564720', '100001564720', '100000628461', '100000628461', '100000641246', '100001566913', '100001566913', '100001568279', '100001568279', '100001569163', '100001569163', '100001568857', '100001568857', '100001572193', '100001572193', '100000662953', '100000662953', '100001572313', '100001572313', '100001572966', '100001572966', '100001569771', '100001569771', '100001579331', '100001579331']
    )).all()

    for mch_inlet_info in mch_inlet_infos:
        new_district = get_areanames_by_city(mch_inlet_info.city)
        if new_district:
            print mch_inlet_info.city, mch_inlet_info.district if mch_inlet_info.district else '1', new_district[0]
            if mch_inlet_info.district != new_district:
                mch_inlet_info.district = new_district
                uline_session.commit()


if __name__ == "__main__":
    initdb()
    ioloop.IOLoop.instance().run_sync(update_error_address)
